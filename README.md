# Discord Bot

Этот репозиторий содержит Discord‑бота для управления учебными группами и лабораторными работами. Ниже описана полная процедура запуска на новом устройстве.

---

## 1. Предварительные требования

- **Python 3.11+** (рекомендуемая версия). Проверьте командой `python --version`.
- **Git** для клонирования репозитория.
- **Discord Bot Token** — получите в [портале разработчиков Discord](https://discord.com/developers/applications), включите необходимые intent’ы (Guild Members, Guild Messages, Message Content).
- Желательно наличие **virtualenv** (или встроенного `python -m venv`) для изоляции зависимостей.

---

## 2. Клонирование проекта

```bash
git clone https://github.com/your-org/discord_bot.git
cd discord_bot
```

> Замените URL на актуальный адрес репозитория, если он отличается.

---

## 3. Настройка виртуального окружения

**Windows**
```powershell
python -m venv .venv
.venv\Scripts\activate
```

**macOS / Linux**
```bash
python3 -m venv .venv
source .venv/bin/activate
```

---

## 4. Установка зависимостей

```bash
pip install -r requirements.txt
```

В проекте используются:

- `discord.py` — основная библиотека бота;
- `python-dotenv` — загрузка переменных окружения из `.env`;
- `tortoise-orm` и `aerich` — работа с базой данных SQLite и миграциями;
- `pandas` + `openpyxl` — работа с Excel‑таблицами (`students.xlsx`).

---

## 5. Настройка переменных окружения

В корне уже лежит файл `.env` с шаблоном:
```
DISCORD_TOKEN=your_token_here
```

1. Отредактируйте `.env`, указав реальный токен бота.
2. (Опционально) Добавьте переменную `READER_FILE_PATH=<путь>` если хотите хранить Excel в другом месте. По умолчанию используется `students.xlsx` в корне проекта.

---

## 6. Состав репозитория и важные файлы

| Путь | Назначение |
|------|------------|
| `bot.py` | Точка входа бота. |
| `config.py` | Загрузка `.env`, конфиг Tortoise ORM. |
| `cogs/` | Набор когов (команды, обработчики событий, UI). |
| `utils/` | Вспомогательные функции (работа с Excel, feedback‑каналы). |
| `database/` | ORM‑модели и инициализация базы. |
| `migrations/` | Настройки Aerich. |
| `requirements.txt` | Список Python‑зависимостей. |

---

## 7. Запуск бота

```bash
python bot.py
```

После запуска в консоли появится сообщение вида `✅ Бот ... запущен!`.

### Дополнительные шаги (опционально)
- **Миграции Aerich**: при изменении моделей выполняйте `aerich migrate` и `aerich upgrade`. Конфигурация хранится в `pyproject.toml`/`config.py`.
- **Перезапуск**: просто остановите процесс (`Ctrl+C`) и снова запустите `python bot.py`.

---

## 8. Первичная настройка на сервере Discord

1. Добавьте бота на сервер через OAuth URL с правами `bot` и `applications.commands`.
2. Убедитесь, что бот обладает правами управления ролями, каналами и сообщениями.
3. При первом запуске бот автоматически создаст:
   - служебный канал `<botname>-feedback` для логов,
   - роль «Неизвестные»,
   - индивидуальные каналы для зарегистрированных пользователей (по мере необходимости).

---

## 9. Основные команды

- `!help` — контекстное меню всех доступных команд (разделено на категории: общие, группы, лабораторные).
- Управление группами (для администраторов): `!addgroup`, `!removegroup`.
- Лабораторные (для преподавателей):
  - `!review @студент <номер> <комментарий>` — вернуть работу на доработку (в UI можно приложить файл).
  - `!accept @студент <номер>` — зачесть лабораторную.
  - `!labfile @студент <номер>` — ссылка на последний прикреплённый файл.
  - `!deletelab @студент <номер>` — удалить запись о лабораторной.
- Студенческие команды: `!labs`, `!submit`, `!status`.

---

## 10. Полезные советы

- **Резервное копирование**: периодически копируйте `database.sqlite3` и `students.xlsx`.
- **Перенос на другое устройство**: достаточно скопировать весь репозиторий (включая базу и Excel), настроить `.env` и установить зависимости.
- **Обновление зависимостей**: при необходимости меняйте версии в `requirements.txt` и переустанавливайте пакеты (`pip install -r requirements.txt --upgrade`).

---
