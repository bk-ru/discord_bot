@startuml
skinparam backgroundColor #ffffff
skinparam classAttributeIconSize 0
skinparam shadowing false

package "discord.ext.commands" {
    class Cog <<abstract>>
    class Bot
}

package "database.models" {
    class User {
        +id: Int
        +discord_id: BigInt
        +first_name: Text
        +last_name: Text
        +group: Text
    }

    class LabWork {
        +id: Int
        +lab_number: Int
        +file_url: Text
        +teacher_file_url: Text
        +status: Char(20)
        +feedback: Text
        +submitted_at: Datetime
        +updated_at: Datetime
        +teacher_message_id: BigInt
        +teacher_channel_id: BigInt
    }

    User "1" <-- "many" LabWork : user
}

package "utils" {
    class FeedbackUtils {
        +ensure_feedback_channel(guild): TextChannel
        +send_feedback_message(guild, message)
    }
}

package "cogs" {
    class EventsCog {
        +bot: Bot
        +on_ready()
        +on_member_join(member)
        +on_member_remove(member)
        +assign_group_role_and_channels(...)
    }

    class GroupManagementCog {
        +bot: Bot
        +add_group(ctx, group_name)
        +remove_group(ctx, group_name)
    }

    class GeneralCommands {
        +bot: Bot
        +info(ctx)
        +ping(ctx)
        +verify(ctx)
    }

    class HelpCog {
        +bot: Bot
        +help_command(ctx)
    }

    class LabsCog {
        +bot: Bot
        +submit_lab(ctx, lab_number)
        +status_lab(ctx, lab_number)
        +review_lab(ctx, student, lab_number, comment)
        +accept_lab(...)
        +delete_lab(...)
        +lab_file(...)
        +resubmit_lab(...)
        +get_or_create_teacher_channel(...)
    }
}

package "cogs.views" {
    class ChannelConflictView {
        +create_new(...)
        +add_to_existing(...)
    }

    class DeleteChannelView {
        +delete_channel(...)
        +keep_channel(...)
    }
}

package "cogs.labs" {
    class LabReviewView {
        +accept(...)
        +review(...)
    }

    class FeedbackModal {
        +on_submit(interaction)
    }
}

Cog <|-- EventsCog
Cog <|-- GroupManagementCog
Cog <|-- GeneralCommands
Cog <|-- HelpCog
Cog <|-- LabsCog

EventsCog ..> ChannelConflictView : uses
EventsCog ..> DeleteChannelView : uses
EventsCog ..> FeedbackUtils : uses

GroupManagementCog ..> FeedbackUtils : logs

LabsCog ..> User : ORM access
LabsCog ..> LabWork : ORM access
LabsCog ..> LabReviewView : creates
LabReviewView ..> LabWork : wraps
LabsCog ..> FeedbackModal : uses
FeedbackModal ..> LabWork : updates
LabsCog ..> FeedbackUtils : logs

GeneralCommands ..> HelpCog : loaded together
Bot --> Cog : loads cogs <<use>>

ChannelConflictView ..> FeedbackUtils : logs
DeleteChannelView ..> FeedbackUtils : logs

LabReviewView ..> FeedbackUtils : logs

@enduml
